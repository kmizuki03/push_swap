# `push_swap` メイン処理のやさしい解説

このドキュメントは、`push_swap` プログラムのエントリーポイント（`main` 関数まわり）を、プログラミング初心者でも読みやすいようにまとめたものです。

---

## 全体のながれ
1. **入力があるか確認** : コマンドライン引数の個数を見て、並べ替える数字が1つも渡されていないなら何もせず終了します。
2. **スタック（リスト）の準備** : `stack_a` と `stack_b` という 2 本のリンクトリストを `NULL`（空の状態）で用意します。
3. **文字列を数値リストに変換** : `parse_args` で文字列の配列を読み取り、`stack_a` に数値ノードを順番に積み上げます。
4. **すでに並んでいないかチェック** : `is_sorted` で `stack_a` が最初から昇順なら、そのまま片付けて終了します。
5. **リストの長さを数えて順位づけ** : `stack_size` で要素数を数え、`index_stack` で小さい値から順番に番号（インデックス）を振ります。
6. **要素数に合わせてソート方法を選択** : `choose_sort` がリストの大きさに応じた関数（`sa`/`sort_three`/`sort_small`/`turk_sort`）を呼び出します。
7. **後始末** : 使ったメモリを `free_stack` で解放し、プログラムを終了します。

---

## 各処理の役わり

### 1. `main` 関数 (`push_swap.c`)
- **目的** : プログラム全体の入り口で、処理の順番を管理します。
- **初心者ポイント** : まず `argc`（引数の数）を調べ、仕事がなければすぐ終わる、という「早期リターン」の書き方が使われています。

### 2. `parse_args` (`parse.c`)
- **目的** : 受け取った文字列を整数に変換し、`stack_a` というリンクトリストへ積み込みます。
- **安全対策** :
  - `is_number` で数字かどうかをチェック。
  - `check_overflow` で `int` の範囲を越えていないか確認。
  - 重複チェック (`has_duplicates`) で同じ数字が複数ないか確認。
- **初心者ポイント** : 途中でエラーが見つかったら `error_exit` でメッセージを出し、確保したメモリを解放して終了します。

### 3. `is_sorted` (`utils.c`)
- **目的** : `stack_a` の先頭から順番に値を見て、常に「次の値が現在の値以上」になっているかを確かめます。
- **初心者ポイント** : `while` ループでリストを1つずつ進めながら比較する典型的なパターンです。

### 4. `stack_size` と `index_stack`
- **`stack_size` (`stack.c`)** : リストを最後までたどって要素数を数えるだけの関数です。
- **`index_stack` (`index_set.c`)** : リスト全体を何度か走査しながら、「一番小さい値には0」「次に小さい値には1」…という具合に `index` を振り分けます。
- **初心者ポイント** : 値そのものではなく「順位」を付けておくと、後でソート手順を決めやすくなります。

### 5. `choose_sort`（`push_swap.c` 内の静的関数）
- **目的** : 要素数に合わせて最適なソート戦略を選ぶ分岐です。
  - 2個だけなら `sa`（swap 操作）で済む。
  - 3個なら `sort_three`。
  - 5個以下なら `sort_small`。
  - それ以上は本格的な `turk_sort` に任せます。
- **初心者ポイント** : `if` / `else if` で条件を並べるときは、「小さいケースから順に」書いておくと読みやすくなります。

### 6. 後始末 (`free_stack`)
- **目的** : `stack_a` と `stack_b` に残っているノードを順に `free` してメモリを解放します。
- **初心者ポイント** : `free_stack` の中で `NULL` チェックをしているので、呼び出す側は安全に呼べます。

---

## まとめ
- `main` は「入力 → 変換 → チェック → ソート → 片付け」という一本道です。
- 各補助関数は、1つの役割に集中して作られており、読み解きやすくなっています。
- エラー処理やメモリ解放が関数にまとめられているので、安全な作りになっているのがポイントです。

初心者の方は、ここで紹介した関数を追いながら実際のコードを開き、処理の流れを追ってみると理解が深まります。
